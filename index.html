<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Snake Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    #game-board {
      background: #111;
      border: 3px solid #4f8cff;
      border-radius: 8px;
      display: grid;
      grid-template-rows: repeat(15, 24px);
      grid-template-columns: repeat(15, 24px);
      gap: 1px;
      margin-bottom: 1.5rem;
    }
    .cell {
      width: 24px;
      height: 24px;
      background: #222;
      border-radius: 2px;
    }
    .snake {
      background: #4f8cff;
    }
    .food {
      background: #ffb347;
    }
    .block {
      background: #666 !important;
    }
    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    button {
      background: #4f8cff;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #3766b1;
    }
    #score {
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }
    footer {
      margin-top: 2rem;
      font-size: 0.8rem;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Snake Game</h1>
  <div id="game-board"></div>
  <div class="controls">
    <button id="up">Up</button>
    <button id="left">Left</button>
    <button id="down">Down</button>
    <button id="right">Right</button>
  </div>
  <div id="score">Score: 0 | Level: 1</div>
  <footer>
    &copy; <span id="currentYear"></span> QVDROYAL/Snake Game. All rights reserved.
  </footer>
  <script>
    // Bản quyền năm tự động
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    // Snake game nhiều level, block, chuyển level khi ăn đủ 30 food
    const boardSize = 15;
    const board = document.getElementById('game-board');
    const scoreEl = document.getElementById('score');
    let snake, direction, food, score, gameInterval, foodEaten, level;
    const cells = [];
    // Định nghĩa map cho từng level (0: trống, 1: block)
    const levels = [
      // Level 1: không block
      Array(boardSize).fill(0).map(() => Array(boardSize).fill(0)),
      // Level 2: block viền ngoài
      Array(boardSize).fill(0).map((_, y) => Array(boardSize).fill(0).map((_, x) => (x === 0 || x === boardSize-1 || y === 0 || y === boardSize-1) ? 1 : 0)),
      // Level 3: block chữ thập
      Array(boardSize).fill(0).map((_, y) => Array(boardSize).fill(0).map((_, x) => (x === Math.floor(boardSize/2) || y === Math.floor(boardSize/2)) ? 1 : 0)),
    ];
    function resetGame(lv=0) {
      level = lv;
      snake = [{x: 7, y: 7}];
      direction = {x: 0, y: -1};
      food = {x: 3, y: 3};
      score = 0;
      foodEaten = 0;
      scoreEl.textContent = 'Score: 0 | Level: ' + (level+1);
      draw();
      if (gameInterval) clearInterval(gameInterval);
      gameInterval = setInterval(move, 140);
    }
    // Khởi tạo cells
    if (cells.length === 0) {
      for (let y = 0; y < boardSize; y++) {
        for (let x = 0; x < boardSize; x++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          board.appendChild(cell);
          cells.push(cell);
        }
      }
    }
    function getIndex(x, y) {
      return y * boardSize + x;
    }
    function draw() {
      cells.forEach(cell => cell.className = 'cell');
      // Vẽ block
      for (let y = 0; y < boardSize; y++) {
        for (let x = 0; x < boardSize; x++) {
          if (levels[level][y][x] === 1) {
            cells[getIndex(x, y)].classList.add('block');
          }
        }
      }
      // Vẽ rắn
      snake.forEach(part => cells[getIndex(part.x, part.y)].classList.add('snake'));
      // Vẽ food
      cells[getIndex(food.x, food.y)].classList.add('food');
    }
    function move() {
      let head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
      // Wrap-around logic
      if (head.x < 0) head.x = boardSize - 1;
      if (head.x >= boardSize) head.x = 0;
      if (head.y < 0) head.y = boardSize - 1;
      if (head.y >= boardSize) head.y = 0;
      // Check collision with self or block
      if (snake.some(p => p.x === head.x && p.y === head.y) || levels[level][head.y][head.x] === 1) {
        clearInterval(gameInterval);
        setTimeout(() => {
          alert('Game Over! Score: ' + score + '\\nQuay về Level 1');
          resetGame(0);
        }, 100);
        return;
      }
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        score++;
        foodEaten++;
        scoreEl.textContent = 'Score: ' + score + ' | Level: ' + (level+1);
        if (foodEaten >= 30) {
          // Chuyển level
          if (level < levels.length-1) {
            setTimeout(() => {
              alert('Chúc mừng! Bạn đã qua Level ' + (level+1));
              resetGame(level+1);
            }, 100);
            return;
          } else {
            setTimeout(() => {
              alert('Bạn đã hoàn thành tất cả các level!');
              resetGame(0);
            }, 100);
            return;
          }
        }
        placeFood();
      } else {
        snake.pop();
      }
      draw();
    }
    function placeFood() {
      let newFood;
      do {
        newFood = {x: Math.floor(Math.random() * boardSize), y: Math.floor(Math.random() * boardSize)};
      } while (
        snake.some(p => p.x === newFood.x && p.y === newFood.y) ||
        levels[level][newFood.y][newFood.x] === 1
      );
      food = newFood;
    }
    document.getElementById('up').onclick = () => direction = {x: 0, y: -1};
    document.getElementById('down').onclick = () => direction = {x: 0, y: 1};
    document.getElementById('left').onclick = () => direction = {x: -1, y: 0};
    document.getElementById('right').onclick = () => direction = {x: 1, y: 0};
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp') direction = {x: 0, y: -1};
      else if (e.key === 'ArrowDown') direction = {x: 0, y: 1};
      else if (e.key === 'ArrowLeft') direction = {x: -1, y: 0};
      else if (e.key === 'ArrowRight') direction = {x: 1, y: 0};
    });
    // Bắt đầu game
    resetGame(0);
  </script>
</body>
</html>
