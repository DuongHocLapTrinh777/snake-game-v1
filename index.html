<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Snake Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(34,34,34,0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .overlay h2 {
      margin-bottom: 1.5rem;
      font-size: 2rem;
      color: #4f8cff;
    }
    .map-select {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .map-btn {
      background: #ffb347;
      color: #222;
      border: none;
      border-radius: 6px;
      padding: 0.8rem 1.5rem;
      font-size: 1.1rem;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    .map-btn.selected, .map-btn:active {
      background: #4f8cff;
      color: #fff;
    }
    .main-btn {
      background: #4f8cff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 1rem 2.5rem;
      font-size: 1.3rem;
      cursor: pointer;
      font-weight: bold;
      margin-top: 1rem;
      transition: background 0.2s;
    }
    .main-btn:active {
      background: #3766b1;
    }
    body {
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      touch-action: none;
    }
    h1 {
      margin-bottom: 0.5rem;
    }
    #game-board {
      background: #111;
      border: 4px solid #4f8cff;
      border-radius: 10px;
      box-shadow: 0 4px 24px rgba(79,140,255,0.12);
      margin: 1rem 0;
      display: grid;
      grid-template-rows: repeat(20, 20px);
      grid-template-columns: repeat(20, 20px);
      gap: 1px;
      max-width: 100vw;
      max-height: 80vw;
      width: 400px;
      height: 400px;
      box-sizing: border-box;
    }
    .cell {
      width: 20px;
      height: 20px;
      background: #222;
      border-radius: 3px;
    }
    .snake {
      background: #4f8cff;
    }
    .food {
      background: #ffb347;
    }
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 1rem;
      user-select: none;
    }
    .btn-row {
      display: flex;
      gap: 1rem;
      margin: 0.2rem 0;
    }
    button {
      background: #4f8cff;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 1.2rem 2.2rem;
      font-size: 1.5rem;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 70px;
      min-height: 60px;
      box-shadow: 0 2px 8px rgba(79,140,255,0.08);
    }
    button:active {
      background: #3766b1;
    }
    @media (max-width: 600px) {
      #game-board {
        width: 96vw;
        height: 96vw;
        max-width: 96vw;
        max-height: 96vw;
      }
      button {
        font-size: 1.2rem;
        padding: 1rem 1.2rem;
        min-width: 50px;
        min-height: 40px;
      }
    }
    /* Mobile-only: ẩn nút điều khiển, hiển thị hướng dẫn vuốt */
    @media (pointer: coarse) {
      .controls {
        display: none !important;
      }
      .swipe-hint {
        display: block;
      }
    }
    .swipe-hint {
      display: none;
      color: #ffb347;
      font-size: 1.1rem;
      margin-top: 1.2rem;
      text-align: center;
      background: rgba(34,34,34,0.7);
      border-radius: 8px;
      padding: 0.7rem 1.2rem;
      max-width: 90vw;
    }
    #score {
      margin-top: 1rem;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <div id="overlay" class="overlay" style="display:flex">
    <h2 id="overlay-title">Snake Game</h2>
    <div id="map-select" class="map-select">
      <button class="map-btn selected" data-size="small">Small</button>
      <button class="map-btn" data-size="medium">Medium</button>
      <button class="map-btn" data-size="large">Large</button>
    </div>
    <button id="start-btn" class="main-btn">Start Game</button>
  </div>
  <div class="swipe-hint">Swipe on the board to control the snake!</div>
  <h1>Snake Game</h1>
  <div id="game-board"></div>
  <div class="controls">
    <div class="btn-row">
      <button id="up">Up</button>
    </div>
    <div class="btn-row">
      <button id="left">Left</button>
      <button id="down">Down</button>
      <button id="right">Right</button>
    </div>
  </div>
  <div id="score">Score: 0</div>
  <script>
    const board = document.getElementById('game-board');
    const scoreEl = document.getElementById('score');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlay-title');
    const startBtn = document.getElementById('start-btn');
    const mapBtns = Array.from(document.querySelectorAll('.map-btn'));
    const mapSelect = document.getElementById('map-select');

    const mapSizes = {
      small: 12,
      medium: 20,
      large: 28
    };
    let boardSize = mapSizes.medium;
    let snake, direction, food, score, gameInterval, cells;

    function setupBoard() {
      board.innerHTML = '';
      board.style.gridTemplateRows = `repeat(${boardSize}, 1fr)`;
      board.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
      cells = [];
      for (let y = 0; y < boardSize; y++) {
        for (let x = 0; x < boardSize; x++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          board.appendChild(cell);
          cells.push(cell);
        }
      }
    }
    function getIndex(x, y) {
      return y * boardSize + x;
    }
    function draw() {
      cells.forEach(cell => {
        cell.className = 'cell';
      });
      // Draw snake
      snake.forEach(part => {
        if (part.x >= 0 && part.x < boardSize && part.y >= 0 && part.y < boardSize)
          cells[getIndex(part.x, part.y)].classList.add('snake');
      });
      // Draw food
      if (food.x >= 0 && food.x < boardSize && food.y >= 0 && food.y < boardSize)
        cells[getIndex(food.x, food.y)].classList.add('food');
    }
    function move() {
      const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
      // Check wall collision
      if (head.x < 0 || head.x >= boardSize || head.y < 0 || head.y >= boardSize) {
        return gameOver();
      }
      // Check self collision
      if (snake.some(part => part.x === head.x && part.y === head.y)) {
        return gameOver();
      }
      snake.unshift(head);
      // Check food
      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = 'Score: ' + score;
        placeFood();
      } else {
        snake.pop();
      }
      draw();
    }
    function placeFood() {
      let newFood;
      do {
        newFood = {
          x: Math.floor(Math.random() * boardSize),
          y: Math.floor(Math.random() * boardSize)
        };
      } while (snake.some(part => part.x === newFood.x && part.y === newFood.y));
      food = newFood;
    }
    function gameOver() {
      clearInterval(gameInterval);
      overlayTitle.textContent = `Game Over! Score: ${score}`;
      startBtn.textContent = 'Play Again';
      overlay.style.display = 'flex';
      mapSelect.style.display = 'none';
    }
    function setDirection(dx, dy) {
      // Prevent reverse
      if (snake.length > 1 && snake[0].x + dx === snake[1].x && snake[0].y + dy === snake[1].y) return;
      direction = {x: dx, y: dy};
    }
    function isTouchDevice() {
      return window.matchMedia('(pointer: coarse)').matches;
    }
    // Button controls (PC)
    if (!isTouchDevice()) {
      document.getElementById('up').onclick = () => setDirection(0, -1);
      document.getElementById('down').onclick = () => setDirection(0, 1);
      document.getElementById('left').onclick = () => setDirection(-1, 0);
      document.getElementById('right').onclick = () => setDirection(1, 0);
      document.addEventListener('keydown', e => {
        if (e.key === 'ArrowUp') setDirection(0, -1);
        else if (e.key === 'ArrowDown') setDirection(0, 1);
        else if (e.key === 'ArrowLeft') setDirection(-1, 0);
        else if (e.key === 'ArrowRight') setDirection(1, 0);
      });
    }
    // Touch controls (mobile)
    if (isTouchDevice()) {
      let touchStartX = 0, touchStartY = 0;
      let touchEndX = 0, touchEndY = 0;
      function handleTouchStart(e) {
        const t = e.touches[0];
        touchStartX = t.clientX;
        touchStartY = t.clientY;
      }
      function handleTouchMove(e) {
        if (!e.touches[0]) return;
        touchEndX = e.touches[0].clientX;
        touchEndY = e.touches[0].clientY;
      }
      function handleTouchEnd() {
        const dx = touchEndX - touchStartX;
        const dy = touchEndY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 20) setDirection(1, 0); // right
          else if (dx < -20) setDirection(-1, 0); // left
        } else {
          if (dy > 20) setDirection(0, 1); // down
          else if (dy < -20) setDirection(0, -1); // up
        }
      }
      const gameBoard = document.getElementById('game-board');
      gameBoard.addEventListener('touchstart', handleTouchStart, {passive: true});
      gameBoard.addEventListener('touchmove', handleTouchMove, {passive: true});
      gameBoard.addEventListener('touchend', handleTouchEnd, {passive: true});
    }
    // Map selection logic
    let selectedMap = 'small';
    mapBtns.forEach(btn => {
      btn.onclick = () => {
        mapBtns.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedMap = btn.getAttribute('data-size');
      };
    });
    function startGame() {
      boardSize = mapSizes[selectedMap];
      snake = [{x: Math.floor(boardSize/2), y: Math.floor(boardSize/2)}];
      direction = {x: 0, y: -1};
      score = 0;
      scoreEl.textContent = 'Score: 0';
      setupBoard();
      placeFood();
      draw();
      overlay.style.display = 'none';
      mapSelect.style.display = 'flex';
      overlayTitle.textContent = 'Snake Game';
      startBtn.textContent = 'Start Game';
      clearInterval(gameInterval);
      gameInterval = setInterval(move, 120);
    }
    startBtn.onclick = startGame;
    // Show overlay on load
    overlay.style.display = 'flex';
    mapSelect.style.display = 'flex';
    overlayTitle.textContent = 'Snake Game';
    startBtn.textContent = 'Start Game';
    // Setup default board
    boardSize = mapSizes[selectedMap];
    setupBoard();
    draw();
  </script>
</body>
</html>
